<!DOCTYPE html><html><head><title>TabRegisterFragment.java</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../../../luper-android/src/com/androidlearner/widget/DragThingPlayhead.java.html" class="source "><span class="base_path">luper-android / src / com / androidlearner / widget / </span><span class="file_name">DragThingPlayhead.java</span></a><a href="../../../../../luper-android/src/com/androidlearner/widget/DragThing.java.html" class="source "><span class="base_path">luper-android / src / com / androidlearner / widget / </span><span class="file_name">DragThing.java</span></a><a href="../../../../../luper-android/src/com/androidlearner/widget/ClipThing.java.html" class="source "><span class="base_path">luper-android / src / com / androidlearner / widget / </span><span class="file_name">ClipThing.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/PopupTestActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">PopupTestActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperProjectEditorActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperProjectEditorActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Sequence.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Sequence.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabProjectsFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabProjectsFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Clip.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Clip.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Track.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Track.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/CanvasTestActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">CanvasTestActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/AudioRecorderTestActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">AudioRecorderTestActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperForgotPasswordActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperForgotPasswordActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/DragThing.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">DragThing.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabLoginFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabLoginFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/DialogFactory.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">DialogFactory.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/SQLiteHelper.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">SQLiteHelper.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/User.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">User.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/FileSelectorActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">FileSelectorActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperMainActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperMainActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Playhead.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Playhead.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Lambda.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Lambda.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LoopTestActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LoopTestActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabFriendsFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabFriendsFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/ColorChipButton.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">ColorChipButton.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperLoginActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperLoginActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TrackView.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TrackView.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabSplashFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabSplashFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperDevToolsActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperDevToolsActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/DragTest.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">DragTest.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperHelp.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperHelp.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabHomeFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabHomeFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/AudioFile.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">AudioFile.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabsAdapter.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabsAdapter.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperSettingsActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperSettingsActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabRegisterFragment.java.html" class="source selected"><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabRegisterFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/rest/LuperRestClient.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / rest / </span><span class="file_name">LuperRestClient.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/SQLiteDataSource.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">SQLiteDataSource.java</span></a><a href="../../../../../luper-web/dashboard/js/main.js.html" class="source "><span class="base_path">luper-web / dashboard / js / </span><span class="file_name">main.js</span></a><a href="../../../../../luper-web/dashboard/js/vendor/bootstrap.min.js.html" class="source "><span class="base_path">luper-web / dashboard / js / vendor / </span><span class="file_name">bootstrap.min.js</span></a><a href="../../../../../luper-web/dashboard/js/vendor/jquery-1.9.1.min.js.html" class="source "><span class="base_path">luper-web / dashboard / js / vendor / </span><span class="file_name">jquery-1.9.1.min.js</span></a><a href="../../../../../luper-web/dashboard/js/vendor/bootstrap.js.html" class="source "><span class="base_path">luper-web / dashboard / js / vendor / </span><span class="file_name">bootstrap.js</span></a><a href="../../../../../luper-web/dashboard/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js.html" class="source "><span class="base_path">luper-web / dashboard / js / vendor / </span><span class="file_name">modernizr-2.6.2-respond-1.1.0.min.js</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>TabRegisterFragment.java</h1><div class="filepath">luper-android/src/com/teamluper/luper/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">teamluper</span><span class="o">.</span><span class="na">luper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.animation.Animator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.animation.AnimatorListenerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.annotation.TargetApi</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Build</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v4.app.Fragment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.text.TextUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.LayoutInflater</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.ViewGroup</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.EditText</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.googlecode.androidannotations.annotations.Background</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.googlecode.androidannotations.annotations.EFragment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.googlecode.androidannotations.annotations.UiThread</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.googlecode.androidannotations.annotations.rest.RestService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.teamluper.luper.rest.LuperRestClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.json.JSONObject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.security.MessageDigest</span><span class="o">;</span>

<span class="nd">@EFragment</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TabRegisterFragment</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="o">{</span>

  <span class="nd">@RestService</span>
  <span class="n">LuperRestClient</span> <span class="n">rest</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">infl</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">vg</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">vg</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">View</span> <span class="n">v</span> <span class="o">=</span> <span class="n">infl</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">tab_register_layout</span><span class="o">,</span> <span class="n">vg</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

    <span class="n">v</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">register_button</span><span class="o">).</span><span class="na">setOnClickListener</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">attemptRegistration</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">});</span>

    <span class="k">return</span> <span class="n">v</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
    <span class="n">showProgress</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@UiThread</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">alert</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">DialogFactory</span><span class="o">.</span><span class="na">alert</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="n">title</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@UiThread</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attemptRegistration</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Activity</span> <span class="n">a</span> <span class="o">=</span> <span class="n">getActivity</span><span class="o">();</span>
    <span class="k">if</span><span class="o">(!</span><span class="n">LuperMainActivity</span><span class="o">.</span><span class="na">deviceIsOnline</span><span class="o">(</span><span class="n">a</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">DialogFactory</span><span class="o">.</span><span class="na">alert</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="s">&quot;Registration Failed!&quot;</span><span class="o">,</span> <span class="s">&quot;You are not connected to the internet! &quot;</span> <span class="o">+</span>
        <span class="s">&quot;You must be online to register or log in.  Once logged in, however, you can use Luper while offline.&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="n">EditText</span> <span class="n">editEmail</span>     <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="n">a</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">register_email</span><span class="o">);</span>
    <span class="n">EditText</span> <span class="n">editPassword</span>  <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="n">a</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">register_password</span><span class="o">);</span>
    <span class="n">EditText</span> <span class="n">editPassword2</span> <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="n">a</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">register_password2</span><span class="o">);</span>
    <span class="n">EditText</span> <span class="n">editUsername</span>  <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="n">a</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">register_username</span><span class="o">);</span>

    <span class="n">editEmail</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="n">editPassword</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="n">editPassword2</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="n">editUsername</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>

    <span class="n">String</span> <span class="n">email</span> <span class="o">=</span> <span class="n">editEmail</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">editPassword</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">password2</span> <span class="o">=</span> <span class="n">editPassword2</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">editUsername</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>

    <span class="kt">boolean</span> <span class="n">cancel</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="n">View</span> <span class="n">focusView</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Check that the passwords match and are valid.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span><span class="o">(!</span><span class="n">password</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">password2</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">editPassword</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="s">&quot;Passwords do not match!&quot;</span><span class="o">);</span>
      <span class="n">focusView</span> <span class="o">=</span> <span class="n">editPassword</span><span class="o">;</span>
      <span class="n">cancel</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">password</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">editPassword</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="s">&quot;Password must be greater than 4 characters.&quot;</span><span class="o">);</span>
      <span class="n">focusView</span> <span class="o">=</span> <span class="n">editPassword</span><span class="o">;</span>
      <span class="n">cancel</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Check that the email is valid.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span><span class="o">(</span><span class="n">TextUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">email</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">editEmail</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="s">&quot;A valid email address is required!&quot;</span><span class="o">);</span>
      <span class="n">focusView</span> <span class="o">=</span> <span class="n">editEmail</span><span class="o">;</span>
      <span class="n">cancel</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(!</span><span class="n">email</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;@&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">editEmail</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="s">&quot;This email address is invalid!&quot;</span><span class="o">);</span>
      <span class="n">focusView</span> <span class="o">=</span> <span class="n">editEmail</span><span class="o">;</span>
      <span class="n">cancel</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Check that the username is specified</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span><span class="o">(</span><span class="n">TextUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">username</span><span class="o">)</span> <span class="o">||</span> <span class="n">username</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">editUsername</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="s">&quot;A display name of at least 4 characters is required.&quot;</span><span class="o">);</span>
      <span class="n">focusView</span> <span class="o">=</span> <span class="n">editUsername</span><span class="o">;</span>
      <span class="n">cancel</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="k">if</span><span class="o">(</span><span class="n">cancel</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">focusView</span><span class="o">.</span><span class="na">requestFocus</span><span class="o">();</span>
      <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="n">completeRegistration</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">password</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Background</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">completeRegistration</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span> <span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">JSONObject</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">MessageDigest</span> <span class="n">md</span> <span class="o">=</span> <span class="n">MessageDigest</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;SHA-256&quot;</span><span class="o">);</span>
      <span class="n">md</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">password</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">&quot;UTF-8&quot;</span><span class="o">));</span> <span class="c1">// Change this to &quot;UTF-16&quot; if needed</span>
      <span class="kt">byte</span><span class="o">[]</span> <span class="n">digest</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="na">digest</span><span class="o">();</span>
      <span class="n">String</span> <span class="n">passwordHash</span> <span class="o">=</span> <span class="n">bytesToHex</span><span class="o">(</span><span class="n">digest</span><span class="o">);</span>
      <span class="n">request</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;passwordHash&quot;</span><span class="o">,</span><span class="n">passwordHash</span><span class="o">);</span>
      <span class="n">request</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">,</span><span class="n">username</span><span class="o">);</span>
      <span class="n">request</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">,</span><span class="n">email</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">&quot;luper&quot;</span><span class="o">,</span><span class="s">&quot;=== Exception while trying to hash password for JSON request ===&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">String</span> <span class="n">requestJSON</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="n">showProgress</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

    <span class="n">String</span> <span class="n">responseJSON</span> <span class="o">=</span> <span class="n">rest</span><span class="o">.</span><span class="na">registerNewAccount</span><span class="o">(</span><span class="n">requestJSON</span><span class="o">);</span>

    <span class="n">JSONObject</span> <span class="n">response</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">responseJSON</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">JSONException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">&quot;luper&quot;</span><span class="o">,</span><span class="s">&quot;=== FAILED TO PARSE RESPONSE JSON FROM /api/auth/register&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
      <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">&quot;luper&quot;</span><span class="o">,</span><span class="s">&quot;=== RESPONSE (which failed to parse as JSON) WAS:&quot;</span><span class="o">);</span>
      <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">&quot;luper&quot;</span><span class="o">,</span><span class="s">&quot;=== &quot;</span><span class="o">+</span><span class="n">responseJSON</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">showProgress</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">isResponseSuccessful</span><span class="o">(</span><span class="n">response</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">registrationSuccess</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="s">&quot;insertId&quot;</span><span class="o">),</span> <span class="n">email</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">registrationFailure</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;message&quot;</span><span class="o">));</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">JSONException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">&quot;luper&quot;</span><span class="o">,</span> <span class="s">&quot;=== POST-PARSE JSON EXCEPTION: &quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@UiThread</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">registrationSuccess</span><span class="o">(</span><span class="kt">long</span> <span class="n">userId</span><span class="o">,</span> <span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">showProgress</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="n">Activity</span> <span class="n">activity</span> <span class="o">=</span> <span class="n">getActivity</span><span class="o">();</span>
    <span class="n">EditText</span> <span class="n">editEmail</span>     <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="n">activity</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">register_email</span><span class="o">);</span>
    <span class="n">EditText</span> <span class="n">editPassword</span>  <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="n">activity</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">register_password</span><span class="o">);</span>
    <span class="n">EditText</span> <span class="n">editPassword2</span> <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="n">activity</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">register_password2</span><span class="o">);</span>
    <span class="n">EditText</span> <span class="n">editUsername</span>  <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="n">activity</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">register_username</span><span class="o">);</span>
    <span class="n">editEmail</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
    <span class="n">editPassword</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
    <span class="n">editPassword2</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
    <span class="n">editUsername</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">LuperLoginActivity</span> <span class="n">a</span> <span class="o">=</span> <span class="o">(</span><span class="n">LuperLoginActivity</span><span class="o">)</span> <span class="n">activity</span><span class="o">;</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">e</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
    <span class="n">DialogFactory</span><span class="o">.</span><span class="na">alert</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="s">&quot;Registration Complete!&quot;</span><span class="o">,</span>
      <span class="s">&quot;Your new account has been registered!  Please re-enter your password to log in.&quot;</span><span class="o">,</span>
      <span class="k">new</span> <span class="n">Lambda</span><span class="o">.</span><span class="na">VoidCallback</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">go</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">a</span><span class="o">.</span><span class="na">prefillLoginForm</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">});</span>
  <span class="o">}</span>

  <span class="nd">@UiThread</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">registrationFailure</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">showProgress</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="n">DialogFactory</span><span class="o">.</span><span class="na">alert</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span> <span class="s">&quot;Registration Failed!&quot;</span><span class="o">,</span> <span class="n">errorMessage</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isResponseSuccessful</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="na">getBoolean</span><span class="o">(</span><span class="s">&quot;success&quot;</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">&quot;luper&quot;</span><span class="o">,</span><span class="s">&quot;=== A REGISTRATION API RESPONSE WAS UNSUCCESSFUL === Exception: &quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">bytesToHex</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">hexArray</span> <span class="o">=</span> <span class="o">{</span><span class="sc">&#39;0&#39;</span><span class="o">,</span><span class="sc">&#39;1&#39;</span><span class="o">,</span><span class="sc">&#39;2&#39;</span><span class="o">,</span><span class="sc">&#39;3&#39;</span><span class="o">,</span><span class="sc">&#39;4&#39;</span><span class="o">,</span><span class="sc">&#39;5&#39;</span><span class="o">,</span><span class="sc">&#39;6&#39;</span><span class="o">,</span><span class="sc">&#39;7&#39;</span><span class="o">,</span><span class="sc">&#39;8&#39;</span><span class="o">,</span><span class="sc">&#39;9&#39;</span><span class="o">,</span><span class="sc">&#39;a&#39;</span><span class="o">,</span><span class="sc">&#39;b&#39;</span><span class="o">,</span><span class="sc">&#39;c&#39;</span><span class="o">,</span><span class="sc">&#39;d&#39;</span><span class="o">,</span><span class="sc">&#39;e&#39;</span><span class="o">,</span><span class="sc">&#39;f&#39;</span><span class="o">};</span>
    <span class="kt">char</span><span class="o">[]</span> <span class="n">hexChars</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">bytes</span><span class="o">.</span><span class="na">length</span> <span class="o">*</span> <span class="mi">2</span><span class="o">];</span>
    <span class="kt">int</span> <span class="n">v</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">bytes</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++</span> <span class="o">)</span> <span class="o">{</span>
      <span class="n">v</span> <span class="o">=</span> <span class="n">bytes</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="o">;</span>
      <span class="n">hexChars</span><span class="o">[</span><span class="n">j</span> <span class="o">*</span> <span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="n">hexArray</span><span class="o">[</span><span class="n">v</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">4</span><span class="o">];</span>
      <span class="n">hexChars</span><span class="o">[</span><span class="n">j</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">hexArray</span><span class="o">[</span><span class="n">v</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="o">];</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">hexChars</span><span class="o">);</span>
  <span class="o">}</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Shows the progress UI and hides the register form.</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="nd">@TargetApi</span><span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">HONEYCOMB_MR2</span><span class="o">)</span>
  <span class="nd">@UiThread</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">showProgress</span><span class="o">(</span><span class="kd">final</span> <span class="kt">boolean</span> <span class="n">show</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Activity</span> <span class="n">a</span> <span class="o">=</span> <span class="n">getActivity</span><span class="o">();</span>
    <span class="kd">final</span> <span class="n">View</span> <span class="n">mRegisterFormView</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">register_form</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">View</span> <span class="n">mRegisterStatusView</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">register_status</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">TextView</span> <span class="n">mRegisterStatusMessageView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">a</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">register_status_message</span><span class="o">);</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>On Honeycomb MR2 we have the ViewPropertyAnimator APIs, which allow
for very easy animations. If available, use these APIs to fade-in
the progress spinner.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">HONEYCOMB_MR2</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">shortAnimTime</span> <span class="o">=</span> <span class="n">getResources</span><span class="o">().</span><span class="na">getInteger</span><span class="o">(</span>
        <span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">integer</span><span class="o">.</span><span class="na">config_shortAnimTime</span><span class="o">);</span>

      <span class="n">mRegisterStatusView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
      <span class="n">mRegisterStatusView</span><span class="o">.</span><span class="na">animate</span><span class="o">().</span><span class="na">setDuration</span><span class="o">(</span><span class="n">shortAnimTime</span><span class="o">).</span><span class="na">alpha</span><span class="o">(</span><span class="n">show</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="o">)</span>
        <span class="o">.</span><span class="na">setListener</span><span class="o">(</span><span class="k">new</span> <span class="n">AnimatorListenerAdapter</span><span class="o">()</span> <span class="o">{</span>
          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAnimationEnd</span><span class="o">(</span><span class="n">Animator</span> <span class="n">animation</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mRegisterStatusView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">show</span> <span class="o">?</span> <span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span> <span class="o">:</span> <span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
          <span class="o">}</span>
        <span class="o">});</span>

      <span class="n">mRegisterFormView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
      <span class="n">mRegisterFormView</span><span class="o">.</span><span class="na">animate</span><span class="o">().</span><span class="na">setDuration</span><span class="o">(</span><span class="n">shortAnimTime</span><span class="o">).</span><span class="na">alpha</span><span class="o">(</span><span class="n">show</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="o">)</span>
        <span class="o">.</span><span class="na">setListener</span><span class="o">(</span><span class="k">new</span> <span class="n">AnimatorListenerAdapter</span><span class="o">()</span> <span class="o">{</span>
          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAnimationEnd</span><span class="o">(</span><span class="n">Animator</span> <span class="n">animation</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mRegisterFormView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">show</span> <span class="o">?</span> <span class="n">View</span><span class="o">.</span><span class="na">GONE</span> <span class="o">:</span> <span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
          <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>The ViewPropertyAnimator APIs are not available, so simply show
and hide the relevant UI components.</p>
</td><td class="code"><div class="highlight"><pre>      <span class="n">mRegisterStatusView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">show</span> <span class="o">?</span> <span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span> <span class="o">:</span> <span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
      <span class="n">mRegisterFormView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">show</span> <span class="o">?</span> <span class="n">View</span><span class="o">.</span><span class="na">GONE</span> <span class="o">:</span> <span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Thu May 02 2013 02:15:16 GMT+0000 (UTC)  </div><div id="projectname"><a href="../../../../../index.html">Luper</a></div></div></body></html>