<!DOCTYPE html><html><head><title>LuperProjectEditorActivity.java</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../../../luper-android/src/com/androidlearner/widget/DragThingPlayhead.java.html" class="source "><span class="base_path">luper-android / src / com / androidlearner / widget / </span><span class="file_name">DragThingPlayhead.java</span></a><a href="../../../../../luper-android/src/com/androidlearner/widget/DragThing.java.html" class="source "><span class="base_path">luper-android / src / com / androidlearner / widget / </span><span class="file_name">DragThing.java</span></a><a href="../../../../../luper-android/src/com/androidlearner/widget/ClipThing.java.html" class="source "><span class="base_path">luper-android / src / com / androidlearner / widget / </span><span class="file_name">ClipThing.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/PopupTestActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">PopupTestActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperProjectEditorActivity.java.html" class="source selected"><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperProjectEditorActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Sequence.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Sequence.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabProjectsFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabProjectsFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Clip.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Clip.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Track.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Track.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/CanvasTestActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">CanvasTestActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/AudioRecorderTestActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">AudioRecorderTestActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperForgotPasswordActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperForgotPasswordActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/DragThing.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">DragThing.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabLoginFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabLoginFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/DialogFactory.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">DialogFactory.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/SQLiteHelper.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">SQLiteHelper.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/User.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">User.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/FileSelectorActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">FileSelectorActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperMainActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperMainActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Playhead.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Playhead.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Lambda.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Lambda.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LoopTestActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LoopTestActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabFriendsFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabFriendsFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/ColorChipButton.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">ColorChipButton.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperLoginActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperLoginActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TrackView.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TrackView.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabSplashFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabSplashFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperDevToolsActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperDevToolsActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/DragTest.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">DragTest.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperHelp.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperHelp.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabHomeFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabHomeFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/AudioFile.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">AudioFile.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabsAdapter.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabsAdapter.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperSettingsActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperSettingsActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabRegisterFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabRegisterFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/rest/LuperRestClient.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / rest / </span><span class="file_name">LuperRestClient.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/SQLiteDataSource.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">SQLiteDataSource.java</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>LuperProjectEditorActivity.java</h1><div class="filepath">luper-android/src/com/teamluper/luper/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">teamluper</span><span class="o">.</span><span class="na">luper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.AlertDialog</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.pm.ActivityInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.Color</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.media.AudioManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.media.MediaPlayer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.media.MediaRecorder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Environment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.ViewGroup</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Button</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.HorizontalScrollView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.LinearLayout</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.RelativeLayout</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.ScrollView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.SeekBar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.actionbarsherlock.app.ActionBar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.actionbarsherlock.app.SherlockActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.actionbarsherlock.view.Menu</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.actionbarsherlock.view.MenuInflater</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.actionbarsherlock.view.MenuItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.androidlearner.widget.DragThingPlayhead</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.googlecode.androidannotations.annotations.EActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.googlecode.androidannotations.annotations.UiThread</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.Bitmap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.drawable.BitmapDrawable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.BitmapFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.graphics.Shader</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>

<span class="nd">@EActivity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LuperProjectEditorActivity</span> <span class="kd">extends</span> <span class="n">SherlockActivity</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">SQLiteDataSource</span> <span class="n">dataSource</span><span class="o">;</span>
  <span class="n">Sequence</span> <span class="n">sequence</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">mFileName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">MediaRecorder</span> <span class="n">mRecorder</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">LOG_TAG</span> <span class="o">=</span> <span class="s">&quot;TrackView&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">TextView</span> <span class="n">fileSelected</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">RecordButton</span> <span class="n">mRecordButton</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">MediaPlayer</span>   <span class="n">mPlayer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Track</span> <span class="n">playBackTest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Track</span> <span class="o">();</span>
  <span class="kd">private</span> <span class="n">AudioManager</span> <span class="n">audioManager</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">ScrollView</span> <span class="n">vert</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">HorizontalScrollView</span> <span class="n">horz</span><span class="o">;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>private LinearLayout base1;</p>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">private</span> <span class="n">DragThingPlayhead</span> <span class="n">base</span><span class="o">;</span>

  <span class="kd">public</span> <span class="n">Clip</span> <span class="n">veryLastClip</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">isPaused</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>this object is gonna move de move.
ClipThing deClip;
int [] paramz;</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>TODO these will be moved to within Sequence, and accessed with
sequence.getClips() and sequence.getTracks(), etc.
ArrayList<Clip> clips = new ArrayList<Clip>();
ArrayList<Track> tracks = new ArrayList<Track>();</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">icicle</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">icicle</span><span class="o">);</span>
    <span class="n">vert</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScrollView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="n">horz</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HorizontalScrollView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="n">base</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DragThingPlayhead</span><span class="o">(</span><span class="k">this</span><span class="o">);</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>LinearLayout top = new LinearLayout(this);</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">TextView</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="n">a</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;Timeline&quot;</span><span class="o">);</span>
    <span class="n">a</span><span class="o">.</span><span class="na">setBackgroundColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">parseColor</span><span class="o">(</span><span class="s">&quot;#f5f5f5&quot;</span><span class="o">));</span>
    <span class="n">base</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">a</span><span class="o">);</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>this.addView(top);</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">base</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1337</span><span class="o">);</span>

    <span class="n">setRequestedOrientation</span><span class="o">(</span><span class="n">ActivityInfo</span><span class="o">.</span><span class="na">SCREEN_ORIENTATION_LANDSCAPE</span><span class="o">);</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>to figure out which sequence data to load, we fetch the Sequences _id from the Intent.
this is put into the intent when you press the project in the Projects list in LuperMainActivity.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="kt">long</span> <span class="n">ID</span> <span class="o">=</span> <span class="n">getIntent</span><span class="o">().</span><span class="na">getLongExtra</span><span class="o">(</span><span class="s">&quot;selectedProjectId&quot;</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">ID</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">DialogFactory</span><span class="o">.</span><span class="na">alert</span><span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="s">&quot;ERROR&quot;</span><span class="o">,</span><span class="s">&quot;No project ID found!  Aborting.&quot;</span><span class="o">,</span>
          <span class="k">new</span> <span class="n">Lambda</span><span class="o">.</span><span class="na">VoidCallback</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">go</span><span class="o">()</span> <span class="o">{</span>
              <span class="n">finish</span><span class="o">();</span>
            <span class="o">}</span>
          <span class="o">});</span>
      <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>set up a connection to the phone's SQLite database.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SQLiteDataSource</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="n">dataSource</span><span class="o">.</span><span class="na">open</span><span class="o">();</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>fetch the sequence object we're editing from SQLite.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">sequence</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getSequenceById</span><span class="o">(</span><span class="n">ID</span><span class="o">);</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>fetch all the Track objects associated with this sequence from SQLite.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">sequence</span><span class="o">.</span><span class="na">tracks</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getTracksBySequenceId</span><span class="o">(</span><span class="n">sequence</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>for each track in the sequence, fetch all the associated Clip and AudioFile objects.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">for</span><span class="o">(</span><span class="n">Track</span> <span class="n">track</span> <span class="o">:</span> <span class="n">sequence</span><span class="o">.</span><span class="na">tracks</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">long</span> <span class="n">trackId</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
      <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Clip</span><span class="o">&gt;</span> <span class="n">clips</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getClipsByTrackId</span><span class="o">(</span><span class="n">trackId</span><span class="o">);</span>
      <span class="n">track</span><span class="o">.</span><span class="na">clips</span> <span class="o">=</span> <span class="n">clips</span><span class="o">;</span>
      <span class="k">for</span><span class="o">(</span><span class="n">Clip</span> <span class="n">clip</span> <span class="o">:</span> <span class="n">track</span><span class="o">.</span><span class="na">clips</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">clip</span><span class="o">.</span><span class="na">audioFile</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getAudioFileById</span><span class="o">(</span><span class="n">clip</span><span class="o">.</span><span class="na">getAudioFileID</span><span class="o">());</span>
        <span class="n">clip</span><span class="o">.</span><span class="na">parentTrack</span> <span class="o">=</span> <span class="n">track</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="k">if</span><span class="o">(</span><span class="n">track</span><span class="o">.</span><span class="na">clips</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="n">track</span><span class="o">.</span><span class="na">nextClip</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="na">clips</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>now that all the Sequence, Track, Clip, and AudioFile objects are in memory, this sequence is ready for editing!</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">sequence</span><span class="o">.</span><span class="na">setReady</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

    <span class="kd">final</span> <span class="n">ActionBar</span> <span class="n">bar</span> <span class="o">=</span> <span class="n">getSupportActionBar</span><span class="o">();</span>
    <span class="n">bar</span><span class="o">.</span><span class="na">setNavigationMode</span><span class="o">(</span><span class="n">ActionBar</span><span class="o">.</span><span class="na">NAVIGATION_MODE_TABS</span><span class="o">);</span> <span class="c1">// Gives us Tabs!</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>base.addView(theplayhead);</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">LinearLayout</span><span class="o">.</span><span class="na">LayoutParams</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinearLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">(</span>
        <span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">MATCH_PARENT</span><span class="o">,</span> <span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">MATCH_PARENT</span><span class="o">);</span>
    <span class="n">base</span><span class="o">.</span><span class="na">setLayoutParams</span><span class="o">(</span><span class="n">params</span><span class="o">);</span>
    <span class="n">Bitmap</span> <span class="n">bmp</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">line</span><span class="o">);</span>
    <span class="n">BitmapDrawable</span> <span class="n">bitmapDrawable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BitmapDrawable</span><span class="o">(</span><span class="n">bmp</span><span class="o">);</span>
    <span class="n">bitmapDrawable</span><span class="o">.</span><span class="na">setTileModeXY</span><span class="o">(</span><span class="n">Shader</span><span class="o">.</span><span class="na">TileMode</span><span class="o">.</span><span class="na">REPEAT</span><span class="o">,</span> <span class="n">Shader</span><span class="o">.</span><span class="na">TileMode</span><span class="o">.</span><span class="na">REPEAT</span><span class="o">);</span>
    <span class="n">base</span><span class="o">.</span><span class="na">setBackgroundDrawable</span><span class="o">(</span><span class="n">bitmapDrawable</span><span class="o">);</span>
    <span class="n">base</span><span class="o">.</span><span class="na">setOrientation</span><span class="o">(</span><span class="n">LinearLayout</span><span class="o">.</span><span class="na">VERTICAL</span><span class="o">);</span>
    <span class="n">base</span><span class="o">.</span><span class="na">setPadding</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>ll2.addView(fileSelected,
       new LinearLayout.LayoutParams(
           ViewGroup.LayoutParams.FILL<em>PARENT,
           ViewGroup.LayoutParams.FILL</em>PARENT,
           0));</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">horz</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">base</span><span class="o">);</span>
    <span class="n">vert</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">horz</span><span class="o">);</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="n">vert</span><span class="o">);</span>

    <span class="n">render</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@UiThread</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">render</span><span class="o">()</span> <span class="o">{</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>LinearLayout base = new LinearLayout(this);
   base.setId(1337);
   base.setBackgroundColor(Color.parseColor("#e2dfd8"));</p>

<p>base.setOrientation(LinearLayout.VERTICAL);</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>RENDERING ROUTINE STARTS HERE</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span><span class="o">(</span><span class="n">sequence</span><span class="o">.</span><span class="na">isReady</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">base</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">base</span><span class="o">.</span><span class="na">getChildCount</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="n">base</span><span class="o">.</span><span class="na">removeAllViews</span><span class="o">();</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>draw stuff in it</p>
</td><td class="code"><div class="highlight"><pre>      <span class="k">for</span><span class="o">(</span><span class="n">Track</span> <span class="n">track</span> <span class="o">:</span> <span class="n">sequence</span><span class="o">.</span><span class="na">tracks</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">RelativeLayout</span> <span class="n">tracklayout</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RelativeLayout</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">TrackView</span> <span class="n">tv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TrackView</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">track</span><span class="o">,</span> <span class="n">dataSource</span><span class="o">);</span>
        <span class="n">track</span><span class="o">.</span><span class="na">addAssociatedView</span><span class="o">(</span><span class="n">tv</span><span class="o">);</span>
        <span class="n">tracklayout</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">tv</span><span class="o">);</span>
        <span class="n">base</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">tracklayout</span><span class="o">,</span>
            <span class="k">new</span> <span class="n">RelativeLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">(</span>
                <span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">WRAP_CONTENT</span><span class="o">,</span>
                <span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">WRAP_CONTENT</span><span class="o">));</span>
      <span class="o">}</span>
    <span class="o">}</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p><div class="dox"><div class="summary"><p>for(Clip clip : track.clips) {<br />          // render the clip<br />          ColorChipButton chip = new ColorChipButton(this, clip);<br />          clip.addAssociatedView(chip);<br />            tv.addView(chip);      //trying to get luping -cs<br />          if(clip.getLoopCount() > 1) {<br />            for(int i=1; i&lt;=clip.getLoopCount(); i++) {<br />              ColorChipButton loopChip = new ColorChipButton(this, clip, i);<br />              tv.addView(loopChip);<br />            }<br />          }</p></div><div class="body"></div></div>         int lup = clip.getLoopCount();
         if(lup >= 1){
           for(int j = 1; j &lt;= lup; j++){
             Clip temp = clip;
             chip = new ColorChipButton(this, temp);
             chip.associated.setStartTime(clip.getStartTime() + (clip.getDurationMS() * j) + 100);
             tv.addView(chip);
       }
     }</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">base</span><span class="o">.</span><span class="na">invalidate</span><span class="o">();</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>setContentView(vert);</p>
</td><td class="code"><div class="highlight"><pre>  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isOpen</span><span class="o">())</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(!</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isOpen</span><span class="o">())</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">open</span><span class="o">();</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>playhead.setXPosition();
if(paramz != null) deClip.layout(paramz[0] , 0, paramz[2], 0);</p>
</td><td class="code"><div class="highlight"><pre>  <span class="o">}</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Override<br />    protected void onPause() {<br />        super.onPause();<br />        //gets the current layout<br />        paramz = deClip.getCurrent();<br />    }</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><h1>Creates the Actionbar</h1>
</td><td class="code"><div class="highlight"><pre>  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onCreateOptionsMenu</span><span class="o">(</span><span class="n">Menu</span> <span class="n">menu</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">MenuInflater</span> <span class="n">inf</span> <span class="o">=</span> <span class="n">getSupportMenuInflater</span><span class="o">();</span>
    <span class="n">inf</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">menu</span><span class="o">.</span><span class="na">editor_bar</span><span class="o">,</span> <span class="n">menu</span><span class="o">);</span>
    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onCreateOptionsMenu</span><span class="o">(</span><span class="n">menu</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onPrepareOptionsMenu</span><span class="o">(</span><span class="n">Menu</span> <span class="n">menu</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">MenuItem</span> <span class="n">playButton</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="na">findItem</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editor_play</span><span class="o">);</span>
    <span class="n">MenuItem</span> <span class="n">pauseButton</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="na">findItem</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editor_pause</span><span class="o">);</span>
    <span class="n">MenuItem</span> <span class="n">stopButton</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="na">findItem</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editor_stop</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">base</span><span class="o">.</span><span class="na">isPlaying</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">playButton</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
      <span class="n">pauseButton</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
      <span class="n">stopButton</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">playButton</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
      <span class="n">pauseButton</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
      <span class="n">stopButton</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onPrepareOptionsMenu</span><span class="o">(</span><span class="n">menu</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onOptionsItemSelected</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">boolean</span> <span class="n">incomplete</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="k">if</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editor_play</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">sequence</span><span class="o">.</span><span class="na">tracks</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">isPaused</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">base</span><span class="o">.</span><span class="na">startPlayback</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="n">base</span><span class="o">.</span><span class="na">startPlayback</span><span class="o">();</span>
          <span class="n">resumeAllMediaPlayers</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>for(Track track  : sequence.tracks) {<br />        for(View v : track.getAssociatedViews()) {<br />          if(TrackView.class.isInstance(v)) {<br />            ((TrackView) v).startPlayingTrack(); // doesn't actually run them in parallel - see trackview<br />          }<br />        }<br />      }</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>    <span class="o">}</span>
    <span class="k">if</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editor_pause</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">isPaused</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
      <span class="n">base</span><span class="o">.</span><span class="na">stopPlayback</span><span class="o">();</span>
      <span class="n">pauseAllMediaPlayers</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">if</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editor_stop</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">isPaused</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
      <span class="n">base</span><span class="o">.</span><span class="na">stopPlayback</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
      <span class="n">stopAllMediaPlayers</span><span class="o">();</span>
      <span class="n">base</span><span class="o">.</span><span class="na">postInvalidate</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">if</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editor_add_track</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Track</span> <span class="n">addTrack</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">createTrack</span><span class="o">(</span><span class="n">sequence</span><span class="o">);</span>
      <span class="n">sequence</span><span class="o">.</span><span class="na">tracks</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">addTrack</span><span class="o">);</span>
      <span class="n">TrackView</span> <span class="n">addTrackView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TrackView</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">addTrack</span><span class="o">,</span> <span class="n">dataSource</span><span class="o">);</span>
      <span class="n">addTrack</span><span class="o">.</span><span class="na">addAssociatedView</span><span class="o">(</span><span class="n">addTrackView</span><span class="o">);</span>
      <span class="n">base</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">addTrackView</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">if</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editor_volume</span><span class="o">)</span> <span class="o">{</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>TODO
incomplete = true;</p>
</td><td class="code"><div class="highlight"><pre>      <span class="n">LinearLayout</span> <span class="n">ll3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinearLayout</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
      <span class="n">SeekBar</span> <span class="n">volBar</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SeekBar</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
      <span class="n">ll3</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">volBar</span><span class="o">,</span>
          <span class="k">new</span> <span class="n">LinearLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">(</span>
              <span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">MATCH_PARENT</span><span class="o">,</span>
              <span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">WRAP_CONTENT</span><span class="o">,</span>
              <span class="mi">0</span><span class="o">));</span><span class="c1">//what we need to get the volume bar to work</span>
      <span class="n">audioManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">AudioManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">AUDIO_SERVICE</span><span class="o">);</span>
      <span class="kt">int</span> <span class="n">maxVolume</span> <span class="o">=</span> <span class="n">audioManager</span><span class="o">.</span><span class="na">getStreamMaxVolume</span><span class="o">(</span><span class="n">AudioManager</span><span class="o">.</span><span class="na">STREAM_MUSIC</span><span class="o">);</span>
      <span class="kt">int</span> <span class="n">curVolume</span> <span class="o">=</span> <span class="n">audioManager</span><span class="o">.</span><span class="na">getStreamVolume</span><span class="o">(</span><span class="n">AudioManager</span><span class="o">.</span><span class="na">STREAM_MUSIC</span><span class="o">);</span>
      <span class="n">volBar</span><span class="o">.</span><span class="na">setMax</span><span class="o">(</span><span class="n">maxVolume</span><span class="o">);</span>
      <span class="n">volBar</span><span class="o">.</span><span class="na">setProgress</span><span class="o">(</span><span class="n">curVolume</span><span class="o">);</span>
      <span class="n">volBar</span><span class="o">.</span><span class="na">setOnSeekBarChangeListener</span><span class="o">(</span><span class="k">new</span> <span class="n">SeekBar</span><span class="o">.</span><span class="na">OnSeekBarChangeListener</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStopTrackingTouch</span><span class="o">(</span><span class="n">SeekBar</span> <span class="n">seekBar</span><span class="o">)</span> <span class="o">{}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStartTrackingTouch</span><span class="o">(</span><span class="n">SeekBar</span> <span class="n">seekBar</span><span class="o">)</span> <span class="o">{}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProgressChanged</span><span class="o">(</span><span class="n">SeekBar</span> <span class="n">seekBar</span><span class="o">,</span> <span class="kt">int</span> <span class="n">progress</span><span class="o">,</span>
                                      <span class="kt">boolean</span> <span class="n">fromUser</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">audioManager</span><span class="o">.</span><span class="na">setStreamVolume</span><span class="o">(</span><span class="n">AudioManager</span><span class="o">.</span><span class="na">STREAM_MUSIC</span><span class="o">,</span> <span class="n">progress</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">});</span>
      <span class="k">new</span> <span class="n">AlertDialog</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
          <span class="o">.</span><span class="na">setView</span><span class="o">(</span><span class="n">ll3</span><span class="o">)</span>
          <span class="o">.</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">if</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editor_help</span><span class="o">)</span> <span class="o">{</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>TODO
incomplete = true;</p>
</td><td class="code"><div class="highlight"><pre>      <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">LuperHelp_</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">if</span><span class="o">(</span><span class="n">incomplete</span><span class="o">)</span> <span class="n">DialogFactory</span><span class="o">.</span><span class="na">alert</span><span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="s">&quot;Incomplete Feature&quot;</span><span class="o">,</span>
        <span class="s">&quot;That button hasn&#39;t been hooked up to anything.&quot;</span><span class="o">);</span>
    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onOptionsItemSelected</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@UiThread</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">invalidateTrackViews</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Track</span> <span class="n">t</span> <span class="o">:</span> <span class="n">sequence</span><span class="o">.</span><span class="na">tracks</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">t</span><span class="o">.</span><span class="na">invalidateAssociatedViews</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@UiThread</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">invalidateClipViews</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Track</span> <span class="n">t</span> <span class="o">:</span> <span class="n">sequence</span><span class="o">.</span><span class="na">tracks</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">for</span><span class="o">(</span><span class="n">Clip</span> <span class="nl">c:</span> <span class="n">t</span><span class="o">.</span><span class="na">clips</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">c</span><span class="o">.</span><span class="na">invalidateAssociatedViews</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">playNextClipIfExistsAtTime</span><span class="o">(</span><span class="kt">int</span> <span class="n">timeMS</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Track</span> <span class="n">t</span> <span class="o">:</span> <span class="n">sequence</span><span class="o">.</span><span class="na">tracks</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">nextClip</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">nextStartTime</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">nextClip</span><span class="o">.</span><span class="na">getStartTime</span><span class="o">();</span>
        <span class="k">if</span><span class="o">(</span><span class="n">nextStartTime</span> <span class="o">&lt;</span> <span class="n">timeMS</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">t</span><span class="o">.</span><span class="na">nextClip</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>todo factor all the playback stuff into the Track instead of the TrackView.</p>
</td><td class="code"><div class="highlight"><pre>          <span class="n">t</span><span class="o">.</span><span class="na">trackView</span><span class="o">.</span><span class="na">playPreparedClip</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">findVeryLastClip</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">latestFinishTime</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="n">Clip</span> <span class="n">lastClip</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Track</span> <span class="n">t</span> <span class="o">:</span> <span class="n">sequence</span><span class="o">.</span><span class="na">tracks</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">for</span><span class="o">(</span><span class="n">Clip</span> <span class="n">c</span> <span class="o">:</span> <span class="n">t</span><span class="o">.</span><span class="na">clips</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">finishTime</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">getStartTime</span><span class="o">()</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="na">getDurationMS</span><span class="o">();</span>
        <span class="k">if</span><span class="o">(</span><span class="n">finishTime</span> <span class="o">&gt;</span> <span class="n">latestFinishTime</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">latestFinishTime</span> <span class="o">=</span> <span class="n">finishTime</span><span class="o">;</span>
          <span class="n">lastClip</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">if</span><span class="o">(</span><span class="n">lastClip</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">veryLastClip</span> <span class="o">=</span> <span class="n">lastClip</span><span class="o">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stopAllMediaPlayers</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Track</span> <span class="n">t</span> <span class="o">:</span> <span class="n">sequence</span><span class="o">.</span><span class="na">tracks</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">t</span><span class="o">.</span><span class="na">trackView</span><span class="o">.</span><span class="na">stopPlaying</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">pauseAllMediaPlayers</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Track</span> <span class="n">t</span> <span class="o">:</span> <span class="n">sequence</span><span class="o">.</span><span class="na">tracks</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">MediaPlayer</span> <span class="n">mp</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">trackView</span><span class="o">.</span><span class="na">getMediaPlayer</span><span class="o">();</span>
      <span class="k">if</span><span class="o">(</span><span class="n">mp</span><span class="o">.</span><span class="na">isPlaying</span><span class="o">())</span> <span class="n">mp</span><span class="o">.</span><span class="na">pause</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">resumeAllMediaPlayers</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Track</span> <span class="n">t</span> <span class="o">:</span> <span class="n">sequence</span><span class="o">.</span><span class="na">tracks</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">MediaPlayer</span> <span class="n">mp</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">trackView</span><span class="o">.</span><span class="na">getMediaPlayer</span><span class="o">();</span>
      <span class="k">if</span><span class="o">(</span><span class="n">mp</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">mp</span><span class="o">.</span><span class="na">isPlaying</span><span class="o">())</span> <span class="n">mp</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">class</span> <span class="nc">RecordButton</span> <span class="kd">extends</span> <span class="n">Button</span> <span class="o">{</span>
    <span class="kt">boolean</span> <span class="n">mStartRecording</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

    <span class="n">OnClickListener</span> <span class="n">clicker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">onRecord</span><span class="o">(</span><span class="n">mStartRecording</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mStartRecording</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">setText</span><span class="o">(</span><span class="s">&quot;Stop recording&quot;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="n">setText</span><span class="o">(</span><span class="s">&quot;Start recording&quot;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">mStartRecording</span> <span class="o">=</span> <span class="o">!</span><span class="n">mStartRecording</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">};</span>

    <span class="kd">public</span> <span class="nf">RecordButton</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">(</span><span class="n">ctx</span><span class="o">);</span>
      <span class="n">setText</span><span class="o">(</span><span class="s">&quot;Start recording&quot;</span><span class="o">);</span>
      <span class="n">setOnClickListener</span><span class="o">(</span><span class="n">clicker</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">onRecord</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">start</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">start</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">startRecording</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">stopRecording</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">startRecording</span><span class="o">()</span> <span class="o">{</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>Sets the name of the file when you start recording as opposed to when you click "Audio Record Test" from the main screen</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">mFileName</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">()+</span><span class="s">&quot;/LuperApp/Clips&quot;</span><span class="o">;</span>
    <span class="n">mFileName</span> <span class="o">+=</span> <span class="s">&quot;/clip_&quot;</span> <span class="o">+</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">+</span><span class="s">&quot;.3gp&quot;</span><span class="o">;</span>

    <span class="n">mRecorder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MediaRecorder</span><span class="o">();</span>
    <span class="n">mRecorder</span><span class="o">.</span><span class="na">setAudioSource</span><span class="o">(</span><span class="n">MediaRecorder</span><span class="o">.</span><span class="na">AudioSource</span><span class="o">.</span><span class="na">MIC</span><span class="o">);</span>
    <span class="n">mRecorder</span><span class="o">.</span><span class="na">setOutputFormat</span><span class="o">(</span><span class="n">MediaRecorder</span><span class="o">.</span><span class="na">OutputFormat</span><span class="o">.</span><span class="na">THREE_GPP</span><span class="o">);</span>
    <span class="n">mRecorder</span><span class="o">.</span><span class="na">setOutputFile</span><span class="o">(</span><span class="n">mFileName</span><span class="o">);</span>

    <span class="n">mRecorder</span><span class="o">.</span><span class="na">setAudioEncoder</span><span class="o">(</span><span class="n">MediaRecorder</span><span class="o">.</span><span class="na">AudioEncoder</span><span class="o">.</span><span class="na">AMR_NB</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
      <span class="n">mRecorder</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
      <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">LOG_TAG</span><span class="o">,</span> <span class="s">&quot;prepare() failed2&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="n">mRecorder</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">stopRecording</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">mRecorder</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="n">mRecorder</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
    <span class="n">fileSelected</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">mFileName</span><span class="o">);</span>
    <span class="n">mRecorder</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@UiThread</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">alert</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">DialogFactory</span><span class="o">.</span><span class="na">alert</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Thu May 02 2013 19:53:13 GMT+0000 (UTC)  </div></div></body></html>