<!DOCTYPE html><html><head><title>LuperLogin.java</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Sequence.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Sequence.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/AudioRecorderTest.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">AudioRecorderTest.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabProjectsFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabProjectsFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Clip.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Clip.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/CanvasTest.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">CanvasTest.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Track.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Track.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/ExampleProject.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">ExampleProject.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperLogin.java.html" class="source selected"><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperLogin.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperSQLiteHelper.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperSQLiteHelper.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/test/TestEffects.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / test / </span><span class="file_name">TestEffects.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/StringCallback.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">StringCallback.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/User.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">User.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/ColorClipView.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">ColorClipView.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LoopTest.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LoopTest.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabFriendsFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabFriendsFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/FileSelector.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">FileSelector.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/ColorChipButton.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">ColorChipButton.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperDataSource.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperDataSource.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/ProjectFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">ProjectFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/PopupTest.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">PopupTest.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TrackView.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TrackView.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperApp.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperApp.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabHomeFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabHomeFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/AudioFile.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">AudioFile.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabsAdapter.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabsAdapter.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/rest/LuperRestClient.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / rest / </span><span class="file_name">LuperRestClient.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperSettings.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperSettings.java</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>LuperLogin.java</h1><div class="filepath">luper-android/src/com/teamluper/luper/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">teamluper</span><span class="o">.</span><span class="na">luper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.animation.Animator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.animation.AnimatorListenerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.annotation.TargetApi</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.AsyncTask</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Build</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.text.TextUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.KeyEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.Menu</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.inputmethod.EditorInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.EditText</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v4.app.FragmentActivity</span><span class="o">;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p><div class="dox"><div class="summary"><p>Activity which displays a login screen to the user, offering registration as<br />well.</p></div><div class="body"></div></div>modified from Activity to FragmentActivity for Facebook</p>
</td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LuperLogin</span> <span class="kd">extends</span> <span class="n">FragmentActivity</span> <span class="o">{</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>A dummy authentication store containing known user names and passwords.<br />TODO: remove after connecting to a real authentication system.</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">DUMMY_CREDENTIALS</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span>
      <span class="s">&quot;foo@example.com:hello&quot;</span><span class="o">,</span> <span class="s">&quot;bar@example.com:world&quot;</span> <span class="o">};</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>The default email to populate the email field with.</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXTRA_EMAIL</span> <span class="o">=</span> <span class="s">&quot;com.example.android.authenticatordemo.extra.EMAIL&quot;</span><span class="o">;</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Keep track of the login task to ensure we can cancel it if requested.</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">private</span> <span class="n">UserLoginTask</span> <span class="n">mAuthTask</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Values for email and password at the time of the login attempt.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">private</span> <span class="n">String</span> <span class="n">mEmail</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">mPassword</span><span class="o">;</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>UI references.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">private</span> <span class="n">EditText</span> <span class="n">mEmailView</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">EditText</span> <span class="n">mPasswordView</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">View</span> <span class="n">mLoginFormView</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">View</span> <span class="n">mLoginStatusView</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">TextView</span> <span class="n">mLoginStatusMessageView</span><span class="o">;</span>
  </pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>Instance of FacebookLoginFragment
private FacebookLoginFragment facebookLoginFragment;</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_luper_login</span><span class="o">);</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Set up the login form.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">mEmail</span> <span class="o">=</span> <span class="n">getIntent</span><span class="o">().</span><span class="na">getStringExtra</span><span class="o">(</span><span class="n">EXTRA_EMAIL</span><span class="o">);</span>
    <span class="n">mEmailView</span> <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">email</span><span class="o">);</span>
    <span class="n">mEmailView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">mEmail</span><span class="o">);</span>

    <span class="n">mPasswordView</span> <span class="o">=</span> <span class="o">(</span><span class="n">EditText</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">password</span><span class="o">);</span>
    <span class="n">mPasswordView</span>
        <span class="o">.</span><span class="na">setOnEditorActionListener</span><span class="o">(</span><span class="k">new</span> <span class="n">TextView</span><span class="o">.</span><span class="na">OnEditorActionListener</span><span class="o">()</span> <span class="o">{</span>
          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onEditorAction</span><span class="o">(</span><span class="n">TextView</span> <span class="n">textView</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span>
              <span class="n">KeyEvent</span> <span class="n">keyEvent</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">login</span> <span class="o">||</span> <span class="n">id</span> <span class="o">==</span> <span class="n">EditorInfo</span><span class="o">.</span><span class="na">IME_NULL</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">attemptLogin</span><span class="o">();</span>
              <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
          <span class="o">}</span>
        <span class="o">});</span>

    <span class="n">mLoginFormView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">login_form</span><span class="o">);</span>
    <span class="n">mLoginStatusView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">login_status</span><span class="o">);</span>
    <span class="n">mLoginStatusMessageView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">login_status_message</span><span class="o">);</span>

    <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">sign_in_button</span><span class="o">).</span><span class="na">setOnClickListener</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">attemptLogin</span><span class="o">();</span>
          <span class="o">}</span>
        <span class="o">});</span>
    </pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>facebook button implementation</p>

<div class="dox"><div class="summary"><p>if (savedInstanceState == null) {<br />        // Add the fragment on initial activity setup<br />        facebookLoginFragment = new FacebookLoginFragment();<br />        getSupportFragmentManager()<br />        .beginTransaction()<br />        .add(android.R.id.content, facebookLoginFragment)<br />        .commit();<br />    } else {<br />        // Or set the fragment from restored state info<br />        facebookLoginFragment = (FacebookLoginFragment) getSupportFragmentManager()<br />        .findFragmentById(android.R.id.content);<br />    }</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onCreateOptionsMenu</span><span class="o">(</span><span class="n">Menu</span> <span class="n">menu</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreateOptionsMenu</span><span class="o">(</span><span class="n">menu</span><span class="o">);</span>
    <span class="n">getMenuInflater</span><span class="o">().</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">menu</span><span class="o">.</span><span class="na">luper_login</span><span class="o">,</span> <span class="n">menu</span><span class="o">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">}</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Attempts to sign in or register the account specified by the login form. If<br />there are form errors (invalid email, missing fields, etc.), the errors are<br />presented and no actual login attempt is made.</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attemptLogin</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">mAuthTask</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Reset errors.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">mEmailView</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="n">mPasswordView</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Store values at the time of the login attempt.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">mEmail</span> <span class="o">=</span> <span class="n">mEmailView</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
    <span class="n">mPassword</span> <span class="o">=</span> <span class="n">mPasswordView</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>

    <span class="kt">boolean</span> <span class="n">cancel</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="n">View</span> <span class="n">focusView</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Check for a valid password.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="o">(</span><span class="n">TextUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">mPassword</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">mPasswordView</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">error_field_required</span><span class="o">));</span>
      <span class="n">focusView</span> <span class="o">=</span> <span class="n">mPasswordView</span><span class="o">;</span>
      <span class="n">cancel</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">mPassword</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">mPasswordView</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">error_invalid_password</span><span class="o">));</span>
      <span class="n">focusView</span> <span class="o">=</span> <span class="n">mPasswordView</span><span class="o">;</span>
      <span class="n">cancel</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Check for a valid email address.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="o">(</span><span class="n">TextUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">mEmail</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">mEmailView</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">error_field_required</span><span class="o">));</span>
      <span class="n">focusView</span> <span class="o">=</span> <span class="n">mEmailView</span><span class="o">;</span>
      <span class="n">cancel</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="n">mEmail</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;@&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">mEmailView</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">error_invalid_email</span><span class="o">));</span>
      <span class="n">focusView</span> <span class="o">=</span> <span class="n">mEmailView</span><span class="o">;</span>
      <span class="n">cancel</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">cancel</span><span class="o">)</span> <span class="o">{</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>There was an error; don't attempt login and focus the first
form field with an error.</p>
</td><td class="code"><div class="highlight"><pre>      <span class="n">focusView</span><span class="o">.</span><span class="na">requestFocus</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Show a progress spinner, and kick off a background task to
perform the user login attempt.</p>
</td><td class="code"><div class="highlight"><pre>      <span class="n">mLoginStatusMessageView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">login_progress_signing_in</span><span class="o">);</span>
      <span class="n">showProgress</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
      <span class="n">mAuthTask</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserLoginTask</span><span class="o">();</span>
      <span class="n">mAuthTask</span><span class="o">.</span><span class="na">execute</span><span class="o">((</span><span class="n">Void</span><span class="o">)</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Shows the progress UI and hides the login form.</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="nd">@TargetApi</span><span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">HONEYCOMB_MR2</span><span class="o">)</span>
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">showProgress</span><span class="o">(</span><span class="kd">final</span> <span class="kt">boolean</span> <span class="n">show</span><span class="o">)</span> <span class="o">{</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>On Honeycomb MR2 we have the ViewPropertyAnimator APIs, which allow
for very easy animations. If available, use these APIs to fade-in
the progress spinner.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">HONEYCOMB_MR2</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">shortAnimTime</span> <span class="o">=</span> <span class="n">getResources</span><span class="o">().</span><span class="na">getInteger</span><span class="o">(</span>
          <span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">integer</span><span class="o">.</span><span class="na">config_shortAnimTime</span><span class="o">);</span>

      <span class="n">mLoginStatusView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
      <span class="n">mLoginStatusView</span><span class="o">.</span><span class="na">animate</span><span class="o">().</span><span class="na">setDuration</span><span class="o">(</span><span class="n">shortAnimTime</span><span class="o">).</span><span class="na">alpha</span><span class="o">(</span><span class="n">show</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="o">)</span>
          <span class="o">.</span><span class="na">setListener</span><span class="o">(</span><span class="k">new</span> <span class="n">AnimatorListenerAdapter</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAnimationEnd</span><span class="o">(</span><span class="n">Animator</span> <span class="n">animation</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">mLoginStatusView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">show</span> <span class="o">?</span> <span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span> <span class="o">:</span> <span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
            <span class="o">}</span>
          <span class="o">});</span>

      <span class="n">mLoginFormView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
      <span class="n">mLoginFormView</span><span class="o">.</span><span class="na">animate</span><span class="o">().</span><span class="na">setDuration</span><span class="o">(</span><span class="n">shortAnimTime</span><span class="o">).</span><span class="na">alpha</span><span class="o">(</span><span class="n">show</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="o">)</span>
          <span class="o">.</span><span class="na">setListener</span><span class="o">(</span><span class="k">new</span> <span class="n">AnimatorListenerAdapter</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAnimationEnd</span><span class="o">(</span><span class="n">Animator</span> <span class="n">animation</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">mLoginFormView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">show</span> <span class="o">?</span> <span class="n">View</span><span class="o">.</span><span class="na">GONE</span> <span class="o">:</span> <span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
            <span class="o">}</span>
          <span class="o">});</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>The ViewPropertyAnimator APIs are not available, so simply show
and hide the relevant UI components.</p>
</td><td class="code"><div class="highlight"><pre>      <span class="n">mLoginStatusView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">show</span> <span class="o">?</span> <span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span> <span class="o">:</span> <span class="n">View</span><span class="o">.</span><span class="na">GONE</span><span class="o">);</span>
      <span class="n">mLoginFormView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">show</span> <span class="o">?</span> <span class="n">View</span><span class="o">.</span><span class="na">GONE</span> <span class="o">:</span> <span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Represents an asynchronous login/registration task used to authenticate the<br />user.</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserLoginTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">Boolean</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">Boolean</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="n">Void</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>TODO: attempt authentication against a network service.</p>
</td><td class="code"><div class="highlight"><pre>      <span class="k">try</span> <span class="o">{</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>Simulate network access.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">credential</span> <span class="o">:</span> <span class="n">DUMMY_CREDENTIALS</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">pieces</span> <span class="o">=</span> <span class="n">credential</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">pieces</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">equals</span><span class="o">(</span><span class="n">mEmail</span><span class="o">))</span> <span class="o">{</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>Account exists, return true if the password matches.</p>
</td><td class="code"><div class="highlight"><pre>          <span class="k">return</span> <span class="n">pieces</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="na">equals</span><span class="o">(</span><span class="n">mPassword</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>TODO: register the new account here.</p>
</td><td class="code"><div class="highlight"><pre>      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPostExecute</span><span class="o">(</span><span class="kd">final</span> <span class="n">Boolean</span> <span class="n">success</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">mAuthTask</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="n">showProgress</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

      <span class="k">if</span> <span class="o">(</span><span class="n">success</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">finish</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">mPasswordView</span><span class="o">.</span><span class="na">setError</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">error_incorrect_password</span><span class="o">));</span>
        <span class="n">mPasswordView</span><span class="o">.</span><span class="na">requestFocus</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCancelled</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">mAuthTask</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="n">showProgress</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Tue Apr 02 2013 19:45:36 GMT+0000 (UTC)  </div><div id="projectname"><a href="../../../../../index.html">Luper for Android</a></div></div></body></html>