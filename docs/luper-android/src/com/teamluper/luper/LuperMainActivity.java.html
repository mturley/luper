<!DOCTYPE html><html><head><title>LuperMainActivity.java</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../../../luper-android/src/com/androidlearner/widget/DragThingPlayhead.java.html" class="source "><span class="base_path">luper-android / src / com / androidlearner / widget / </span><span class="file_name">DragThingPlayhead.java</span></a><a href="../../../../../luper-android/src/com/androidlearner/widget/DragThing.java.html" class="source "><span class="base_path">luper-android / src / com / androidlearner / widget / </span><span class="file_name">DragThing.java</span></a><a href="../../../../../luper-android/src/com/androidlearner/widget/ClipThing.java.html" class="source "><span class="base_path">luper-android / src / com / androidlearner / widget / </span><span class="file_name">ClipThing.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/PopupTestActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">PopupTestActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperProjectEditorActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperProjectEditorActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Sequence.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Sequence.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabProjectsFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabProjectsFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Clip.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Clip.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Track.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Track.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/CanvasTestActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">CanvasTestActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/AudioRecorderTestActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">AudioRecorderTestActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperForgotPasswordActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperForgotPasswordActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/DragThing.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">DragThing.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabLoginFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabLoginFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/DialogFactory.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">DialogFactory.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/SQLiteHelper.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">SQLiteHelper.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/User.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">User.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/FileSelectorActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">FileSelectorActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperMainActivity.java.html" class="source selected"><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperMainActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Playhead.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Playhead.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/Lambda.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">Lambda.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LoopTestActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LoopTestActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabFriendsFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabFriendsFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/ColorChipButton.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">ColorChipButton.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperLoginActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperLoginActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TrackView.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TrackView.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabSplashFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabSplashFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperDevToolsActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperDevToolsActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/DragTest.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">DragTest.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperHelp.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperHelp.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabHomeFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabHomeFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/AudioFile.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">AudioFile.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabsAdapter.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabsAdapter.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/LuperSettingsActivity.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">LuperSettingsActivity.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/TabRegisterFragment.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">TabRegisterFragment.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/rest/LuperRestClient.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / rest / </span><span class="file_name">LuperRestClient.java</span></a><a href="../../../../../luper-android/src/com/teamluper/luper/SQLiteDataSource.java.html" class="source "><span class="base_path">luper-android / src / com / teamluper / luper / </span><span class="file_name">SQLiteDataSource.java</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>LuperMainActivity.java</h1><div class="filepath">luper-android/src/com/teamluper/luper/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><h2>LuperApp.java</h2>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>NOTE: ActionBarSherlock is a polyfill providing the new Android 4.2 ActionBar
      functionality to all versions of android.  To compile this project
      properly, the actionbarsherlock project must also be in your
      workspace and/or build path in addition to the Luper project.
      See README.md on github for more details.</p>
</td><td class="code"><div class="highlight"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">teamluper</span><span class="o">.</span><span class="na">luper</span><span class="o">;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>imports from the core android API</p>
</td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">android.accounts.Account</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.accounts.AccountManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.BroadcastReceiver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.IntentFilter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.pm.ActivityInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.net.ConnectivityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.net.NetworkInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Environment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v4.app.Fragment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v4.view.ViewPager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.LayoutInflater</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View.OnClickListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.ViewGroup</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.actionbarsherlock.app.ActionBar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.actionbarsherlock.app.SherlockFragmentActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.actionbarsherlock.view.Menu</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.actionbarsherlock.view.MenuInflater</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.actionbarsherlock.view.MenuItem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.googlecode.androidannotations.annotations.AfterViews</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.googlecode.androidannotations.annotations.Background</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.googlecode.androidannotations.annotations.EActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.googlecode.androidannotations.annotations.UiThread</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>@EActivity = "Enhanced Activity", which turns on AndroidAnnotati1ons features</p>
</td><td class="code"><div class="highlight"><pre><span class="nd">@EActivity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LuperMainActivity</span> <span class="kd">extends</span> <span class="n">SherlockFragmentActivity</span> <span class="o">{</span>

  <span class="kd">static</span> <span class="n">LuperMainActivity</span> <span class="n">instance</span><span class="o">;</span>

  <span class="n">ViewPager</span> <span class="n">mViewPager</span><span class="o">;</span>
  <span class="n">TabsAdapter</span> <span class="n">mTabsAdapter</span><span class="o">;</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Additional local variables</p>
</td><td class="code"><div class="highlight"><pre>  <span class="n">AccountManager</span> <span class="n">am</span><span class="o">;</span>
  <span class="n">SQLiteDataSource</span> <span class="n">dataSource</span><span class="o">;</span>

  <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

    <span class="n">setRequestedOrientation</span><span class="o">(</span><span class="n">ActivityInfo</span><span class="o">.</span><span class="na">SCREEN_ORIENTATION_PORTRAIT</span><span class="o">);</span>

    <span class="kd">final</span> <span class="n">ActionBar</span> <span class="n">bar</span> <span class="o">=</span> <span class="n">getSupportActionBar</span><span class="o">();</span>
    <span class="n">bar</span><span class="o">.</span><span class="na">setNavigationMode</span><span class="o">(</span><span class="n">ActionBar</span><span class="o">.</span><span class="na">NAVIGATION_MODE_TABS</span><span class="o">);</span> <span class="c1">// Gives us Tabs!</span>
    <span class="n">bar</span><span class="o">.</span><span class="na">setDisplayShowTitleEnabled</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="n">bar</span><span class="o">.</span><span class="na">setDisplayHomeAsUpEnabled</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>set up the ViewPager, which we will use in conjunction with tabs.
this makes it possible to swipe left and right between the tabs.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">mViewPager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ViewPager</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="n">mViewPager</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tabcontentpager</span><span class="o">);</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="n">mViewPager</span><span class="o">);</span>

    <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SQLiteDataSource</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="n">dataSource</span><span class="o">.</span><span class="na">open</span><span class="o">();</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>FIXME this is slowing down the app launch dramatically.  Perhaps do it in background?
Creates a folder for Luper and associated clips and projects</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">File</span> <span class="n">nfile</span><span class="o">=</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">()+</span><span class="s">&quot;/LuperApp/Clips&quot;</span><span class="o">);</span>
    <span class="n">File</span> <span class="n">mfile</span><span class="o">=</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">()+</span><span class="s">&quot;/LuperApp/Projects&quot;</span><span class="o">);</span>
    <span class="n">nfile</span><span class="o">.</span><span class="na">mkdir</span><span class="o">();</span>
    <span class="n">mfile</span><span class="o">.</span><span class="na">mkdir</span><span class="o">();</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>now we set up the TabsAdapter, which is a special class borrowed from Google.
TabsAdapter.java takes care of all the guts of the Tab interactions, and
links it with our ViewPager for us.  The code below is all we need to
add some fragment content as tabs in the ActionBar!</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">mTabsAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TabsAdapter</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">mViewPager</span><span class="o">);</span>
    <span class="n">mTabsAdapter</span><span class="o">.</span><span class="na">addTab</span><span class="o">(</span><span class="n">bar</span><span class="o">.</span><span class="na">newTab</span><span class="o">().</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="s">&quot;Home&quot;</span><span class="o">),</span>
        <span class="n">TabHomeFragment_</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="n">mTabsAdapter</span><span class="o">.</span><span class="na">addTab</span><span class="o">(</span><span class="n">bar</span><span class="o">.</span><span class="na">newTab</span><span class="o">().</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="s">&quot;Projects&quot;</span><span class="o">),</span>
        <span class="n">TabProjectsFragment_</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="n">mTabsAdapter</span><span class="o">.</span><span class="na">addTab</span><span class="o">(</span><span class="n">bar</span><span class="o">.</span><span class="na">newTab</span><span class="o">().</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="s">&quot;Friends&quot;</span><span class="o">),</span>
        <span class="n">TabFriendsFragment_</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>create a directory to save in</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">File</span> <span class="n">testdir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;/LuperApp/&quot;</span><span class="o">);</span>
    <span class="n">testdir</span><span class="o">.</span><span class="na">mkdirs</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isOpen</span><span class="o">())</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(!</span><span class="n">dataSource</span><span class="o">.</span><span class="na">isOpen</span><span class="o">())</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">open</span><span class="o">();</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onCreateOptionsMenu</span><span class="o">(</span><span class="n">Menu</span> <span class="n">menu</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">MenuInflater</span> <span class="n">inf</span> <span class="o">=</span> <span class="n">getSupportMenuInflater</span><span class="o">();</span>
    <span class="n">inf</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">menu</span><span class="o">.</span><span class="na">activity_main</span><span class="o">,</span> <span class="n">menu</span><span class="o">);</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>because one of the action items is a custom view,
we need the next few lines to force it to use onOptionsItemSelected
when it's clicked.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="kd">final</span> <span class="n">MenuItem</span> <span class="n">item</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="na">findItem</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">menu_new_project</span><span class="o">);</span>
    <span class="n">item</span><span class="o">.</span><span class="na">getActionView</span><span class="o">().</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">onOptionsItemSelected</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">});</span>

    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onCreateOptionsMenu</span><span class="o">(</span><span class="n">menu</span><span class="o">);</span>
  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">startHelp</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">LuperHelp_</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onOptionsItemSelected</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">menu_new_project</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">DialogFactory</span><span class="o">.</span><span class="na">prompt</span><span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="s">&quot;New Project&quot;</span><span class="o">,</span>
        <span class="s">&quot;Please type a name for your project.  You can change it later.&quot;</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">Lambda</span><span class="o">.</span><span class="na">StringCallback</span><span class="o">()</span> <span class="o">{</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">go</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">newProject</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">);</span>
    <span class="o">}</span>
    <span class="k">if</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">menu_settings</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">LuperSettingsActivity_</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">if</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">menu_logout</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">Activity</span> <span class="n">a</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
      <span class="kd">final</span> <span class="n">SQLiteDataSource</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
      <span class="n">DialogFactory</span><span class="o">.</span><span class="na">confirm</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;Really Log Out?&quot;</span><span class="o">,</span> <span class="s">&quot;You will lose the ability to work offline until the next time you log in (while online) and sync.&quot;</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">Lambda</span><span class="o">.</span><span class="na">BooleanCallback</span><span class="o">()</span> <span class="o">{</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">go</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">userPressedYes</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">userPressedYes</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">ds</span><span class="o">.</span><span class="na">logoutActiveUser</span><span class="o">();</span>
              <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">LuperLoginActivity_</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
              <span class="n">intent</span><span class="o">.</span><span class="na">setFlags</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_CLEAR_TOP</span><span class="o">);</span>
              <span class="n">intent</span><span class="o">.</span><span class="na">setFlags</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="o">);</span>
              <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">&quot;luperLoggingOutFlag&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
              <span class="n">a</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
              <span class="n">DialogFactory</span><span class="o">.</span><span class="na">toastMessage</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="s">&quot;Logged out. Thanks for using Luper!&quot;</span><span class="o">);</span>
              <span class="n">a</span><span class="o">.</span><span class="na">finish</span><span class="o">();</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
    <span class="k">if</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">devtools</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">LuperDevToolsActivity_</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">help</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">LuperHelp_</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
          <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onOptionsItemSelected</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">SQLiteDataSource</span> <span class="nf">getDataSource</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">deviceIsOnline</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>borrowed implementation from:
http://stackoverflow.com/questions/2789612/how-can-i-check-whether-an-android-device-is-connected-to-the-web</p>
</td><td class="code"><div class="highlight"><pre>    <span class="n">ConnectivityManager</span> <span class="n">cm</span> <span class="o">=</span>
      <span class="o">(</span><span class="n">ConnectivityManager</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">CONNECTIVITY_SERVICE</span><span class="o">);</span>
    <span class="n">NetworkInfo</span> <span class="n">ni</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="na">getActiveNetworkInfo</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">ni</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">ni</span><span class="o">.</span><span class="na">isConnected</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@UiThread</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">alert</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">DialogFactory</span><span class="o">.</span><span class="na">alert</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">title</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">newProject</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Sequence</span> <span class="n">newSequence</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">createSequence</span><span class="o">(</span><span class="n">dataSource</span><span class="o">.</span><span class="na">getActiveUser</span><span class="o">(),</span> <span class="n">title</span><span class="o">);</span>
    <span class="n">ListView</span> <span class="n">lv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ListView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">projectsListView</span><span class="o">);</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;unchecked&quot;</span><span class="o">)</span>
    <span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">Sequence</span><span class="o">&gt;</span> <span class="n">adapter</span> <span class="o">=</span> <span class="o">(</span><span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">Sequence</span><span class="o">&gt;)</span> <span class="n">lv</span><span class="o">.</span><span class="na">getAdapter</span><span class="o">();</span>
    <span class="n">adapter</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">newSequence</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Background</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">devTools</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">LuperDevToolsActivity_</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
  <span class="o">}</span>


  <span class="nd">@Background</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">launchProjectEditor</span><span class="o">(</span><span class="kt">long</span> <span class="n">projectId</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">LuperProjectEditorActivity_</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">projectId</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span>  <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">&quot;selectedProjectId&quot;</span><span class="o">,</span> <span class="n">projectId</span><span class="o">);</span>
    <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
  <span class="o">}</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>this will be removed too, it's checking the google account that the
device's user is already logged in with.  We'll likely ditch this in favor
of a Facebook-based login solution.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nd">@Background</span>
  <span class="kt">void</span> <span class="nf">testAccounts</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">am</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="n">am</span> <span class="o">=</span> <span class="n">AccountManager</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="n">Account</span><span class="o">[]</span> <span class="n">accounts</span> <span class="o">=</span> <span class="n">am</span><span class="o">.</span><span class="na">getAccountsByType</span><span class="o">(</span><span class="s">&quot;com.google&quot;</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;== LUPER ACCOUNTS TESTING ==  found &quot;</span><span class="o">+</span><span class="n">accounts</span><span class="o">.</span><span class="na">length</span><span class="o">+</span><span class="s">&quot; accounts&quot;</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">accounts</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">accounts</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">TabsAdapter</span> <span class="nf">checkTabs</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">mTabsAdapter</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Thu May 02 2013 19:53:16 GMT+0000 (UTC)  </div></div></body></html>